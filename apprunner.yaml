version: 1.0
runtime: python3
build:
  commands:
    pre-build:
      - echo "Installing Go..."
      - wget -q https://go.dev/dl/go1.24.0.linux-amd64.tar.gz
      - tar -C /tmp -xzf go1.24.0.linux-amd64.tar.gz
      - export PATH=/tmp/go/bin:$PATH
      - export GOPATH=/tmp/go-path
      - export PATH=$GOPATH/bin:$PATH
      - go version
      - echo "Installing templ..."
      - go install github.com/a-h/templ/cmd/templ@latest
      - echo "Installing Node dependencies..."
      - npm ci
    build:
      - echo "Generating templ files..."
      - templ generate
      - echo "Building CSS..."
      - npm run build
      - echo "Building Go application..."
      - go build -o app .
run:
  runtime-version: 3.8
  command: ./app
  network:
    port: 8080
  env:
    - name: PORT
      value: "8080"
